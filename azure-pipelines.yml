trigger:
- main

pool:
  Default
  #vmImage: ubuntu-latest
  #MylocalPool

variables:
- name: LT_USERNAME
  value: vaneetb 
- name: LT_ACCESS_KEY
  value: PQ2AhuxqqOWAfvzfJlvPaOqusS7YKqfwFJR6DoWY2vsA8CvTzC 

stages:
- stage: BuildAndTest
  jobs:
  - job: BuildAndTestJob
    displayName: "Run Tests on LambdaTest"

    steps:
      - task: configuration@1
        displayName: "Setup LambdaTest Configuration"
        inputs:
          connection: vaneet-test
        env:
          LT_USERNAME: $(LT_USERNAME)
          LT_ACCESS_KEY: $(LT_ACCESS_KEY)

      - script: |
          mvn clean install -DskipTests
        displayName: "Build Project"

      - script: |
          mvn test -D suite=single.xml
        displayName: "Run TestNG Tests"
        env:
          LT_USERNAME: $(LT_USERNAME)
          LT_ACCESS_KEY: $(LT_ACCESS_KEY)

      - task: LambdatestResults@1
        displayName: "Publish LambdaTest Results"
        env:
          LT_USERNAME: $(LT_USERNAME)
          LT_ACCESS_KEY: $(LT_ACCESS_KEY)
